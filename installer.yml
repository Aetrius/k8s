---
- name: control plane setup
  hosts: "{{ target }}"
  become: true
 
  tasks:

  - name: run an apt update
    shell: sudo apt update

  - name: run an apt install docker.io
    shell: sudo apt install docker.io
  
  - name: start docker
    shell: sudo systemctl start docker
  
  - name: start docker
    shell: sudo systemctl enable docker
  
  - name: Start K8s install
    shell: sudo apt install apt-transport-https curl

  - name: curl key
    shell: curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add
  
  - name: add repo
    shell: sudo apt-add-repository "deb http://apt.kubernetes.io/ kubernetes-xenial main"

  - name: install k8s
    shell: sudo apt install kubeadm kubelet kubectl kubernetes-cni

  - name: disable swap
    shell: sudo swapoff -a
  
  - name: disable swap 2
    shell: sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab
  
  
